---
title: "Lab 7 | Group 3"
format: html
editor: visual
---

Authors: s184324, s184344, s184330, s194699, s194691

Date: 3/10 2023

## Introduction

This assignment explores the gravier data set. The data set describes the gene expression from 168 patients used to predict metastasis of small node-negative breast carcinoma with either good (111 patients with no event at 5 years after diagnosis) or poor (57 patients with early metastasis) outcome.

We aim to answer the following question:

What genes are significantly up-/down-regulated between the patients with- and without early metastasis?

## Load Data

Load libraries:

```{r}
#| message: false
library("tidyverse")
library("patchwork")
library("broom")
library("ggrepel")
```

Get the data:

```{r}
target_url <- "https://github.com/ramhiser/datamicroarray/raw/master/data/gravier.RData"
output_file <- "gravier.RData"
curl::curl_download(url = target_url,
                    destfile = output_file)
load(file = "gravier.RData")
```

## Clean Data

Create tibble:

```{r}
gravier_clean <- gravier |>
  bind_cols() |>
  as_tibble()
```

```{r}
gravier_clean <- gravier_clean |>
  mutate(y = case_when(y == "poor" ~ 1,
                       y == "good" ~ 0)) |> 
  relocate(early_metastasis = y)
```

## Create subset

```{r}
set.seed(101023)

gravier_clean_subset <- gravier_clean |>
  select(early_metastasis,
         rdunif(10, b = 2, a = ncol(gravier_clean)))
```

```{r}
pca_fit <- gravier_clean_subset |> 
  select(!early_metastasis) |> 
  prcomp(scale = TRUE) 
```


## Plot 1
```{r}
pca_fit |> 
  augment(gravier_clean_subset) |>  # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, color = factor(early_metastasis))) + 
  geom_point(size = 1.5) +
  labs(color = "Early metastasis", title = "PCA component 1 and 2", subtitle = "0: No metastasis, 1: Early metastasis")
```




## Rotation matrix
```{r}
# check the rotation
pca_fit %>%
  tidy(matrix = "rotation")

# define arrow style for plotting
arrow_style <- arrow(
  angle = 20, ends = "first", type = "closed", length = grid::unit(8, "pt")
)

# plot rotation matrix
pca_fit %>%
  tidy(matrix = "rotation") %>%
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value") %>%
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, yend = 0, arrow = arrow_style) +
  geom_text(
    aes(label = column),
    hjust = 1, nudge_x = -0.02, 
    color = "#904C2F"
  ) +
  xlim(-1, .5) + ylim(-.5, .5) +
  coord_fixed() + # fix aspect ratio to 1:1
  labs(
    title = "Principal Component Rotation Matrix"
  ) +
  theme_minimal()
```


## Plot 3




